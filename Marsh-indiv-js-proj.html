<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        let data = [];
        let saves = [];
        let selectedRow = -1;
        let loadindex = -1;

        class Save {
            constructor(name, date) {
                this.name = name;
                this.date = date;
            }

            toTableRow() {
                return "<td>" + this.name + "</td><td>" + this.date.toDateString() + "</td>";
            }
        }

        class Song {
            constructor(album, artist, genre, reld, dreld) {
                this.album = album;
                this.artist = artist;
                this.genre = genre;
                this.reld = reld;
                this.dreld = dreld;
            }

            toTableRow() {
                return "<td>" + this.album + "</td><td>" + this.artist + "</td><td>" + this.genre + "</td> <td>" + this.dreld + "</td>"
            }
        }

        function addData(alb, art, gen, date, display) {
            selectedRow = -1;
            data.push(new Song(alb, art, gen, date, display));
            reloadTable()
        }

        function reloadTable() {
            let innercode = "<tr><th>Album</th><th>Artist</th><th>Genre</th><th>Release Date</th></tr>";
            let dropdown = "";
            for (let i = 0; i < data.length; i++) {
                innercode += "<tr onmouseup='selectedRow = " + i + ";selectEntry(selectedRow);reloadTable()' class='entry";
                dropdown += "<option value='" + (i + 1) + "'>" + data[i].album + "</option>";
                if (i === selectedRow)
                    innercode += " selected";
                innercode += "'>" + data[i].toTableRow() + "</tr>";
            }
            document.getElementById("album_list").innerHTML = innercode;
            document.getElementById("selectbox").innerHTML = dropdown;
        }

        function selectEntry(index) {
            selectedRow = index;
            document.getElementById('album').value = data[index].album;
            document.getElementById('artist').value = data[index].artist;
            document.getElementById('genre').value = data[index].genre;
            document.getElementById('release_date').value = data[index].dreld;
            reloadTable();
        }

        function sToCookie() {
            let savedata = "";
            for (let j = 0; j < saves.length; j++) {
                savedata += saves[j].name + "|" + saves[j].date;
                if (j !== saves.length - 1) {
                    savedata += "^";
                }
            }
            localStorage.setItem("savemap", savedata);
        }

        function reloadSaves() {
            let rawdata = localStorage.getItem("savemap");
            if (rawdata !== "") {
                let saveentries = rawdata.split("^");
                for (let i = 0; i < saveentries.length; i++) {
                    let temp = saveentries[i].split("|");
                    saves[i] = new Save(temp[0], new Date(temp[1]));
                }
            }
            reloadSaveTable();
        }

        function save(name) {
            for (let i = 0; i < saves.length; i++) {
                if (saves[i].name === name) {
                    loadindex = i;
                }
            }
            if (loadindex === -1) {
                saves.push(new Save(name, new Date()));
            }
            let savedata = "";
            for (let j = 0; j < data.length; j++) {
                savedata += data[j].album +
                    "|" + data[j].artist +
                    "|" + data[j].genre +
                    "|" + data[j].reld +
                    "|" + data[j].dreld;
                if (j !== data.length - 1) {
                    savedata += "^";
                }
            }
            localStorage.setItem(name, savedata);
            sToCookie();
        }

        function deleteSave(index) {
            saves.splice(index, 1);
            loadindex = -1;
            sToCookie();
            reloadSaves();
        }

        function reloadSaveTable() {
            let innerelement = "<tr><th>Save Name</th><th>Date Modified</th></tr>";
            for (let i = 0; i < saves.length; i++) {
                innerelement += "<tr class='save_entry";
                if (loadindex === i)
                    innerelement += " selected";
                innerelement += "' onmouseup='loadindex = " + i + "; reloadSaveTable()'>" + saves[i].toTableRow() + "</tr>";
            }
            document.getElementById("save_list").innerHTML = innerelement;
        }

        function load(index) {
            data = [];
            let rawdata = localStorage.getItem(saves[index].name);
            let entries = rawdata.split("^");
            for (let i = 0; i < entries.length; i++) {
                let temp = entries[i].split("|");
                data.push(new Song(temp[0], temp[1], temp[2], temp[3], temp[4]))
            }
            reloadTable();
        }
    </script>
    <style>
        body {
            margin: 0;
            /*background-color: #207081;*/
            user-select: none;
        }

        h1 {
            text-align: center;
            width: 100%;
        }

        #form {
            position: absolute;
            text-align: center;
            width: 50%;
            height: 100%;
        }

        #list {
            position: absolute;
            text-align: center;
            right: 0;
            width: 50%;
            height: 100%;
            overflow-y: auto;
        }

        #album_list {
            position: absolute;
            border-collapse: collapse;
            text-align: left;
            width: 100%;
        }

        .entry:hover {
            background-color: darkgray !important;
        }

        #interaction {
            position: absolute;
            width: 100%;
            height: 20%;
            padding-top: 30px;
        }

        .button {
            padding: 10px;
            width: 10%;
            background-color: darkgray;
            border: none;
            border-radius: 10px;
        }

        .button:hover {
            background-color: #cccccc;
        }

        .entry_label {
            color: white;
            position: absolute;
            background-color: #3e4f8a;
            display: none;
        }

        .text_entry {
            border: 1px solid black;
            border-radius: 10px;
            padding: 5px 14px;
            width: 200px;
        }

        #loadmenu, #savemenu {
            position: absolute;
            margin-top: 9%;
            width: 100%;
            display: none;
        }

        #saves_table {
            position: absolute;
            margin-top: 15%;
            width: 100%;
            display: none;
        }

        #save_list {
            position: absolute;
            width: 100%;
            top: 20%;
            border-collapse: collapse;
        }

        .save_entry td {
            border: none !important;
        }

        .save_entry:hover {
            background-color: darkgray !important;
        }

        .selected {
            background-color: #909090 !important;
        }
    </style>
</head>
<body onload="reloadSaves()">

<div id="form">
    <h1>
        Javascript project thing
    </h1>
    <div>
        <h3>Album</h3>
        <label class="entry_label" for="album">Album</label>
        <input class="text_entry" type="text" id="album" list="selectbox" onchange='selectEntry(parseInt(this.value) - 1)'>
        <datalist id="selectbox">
        </datalist>
    </div>
    <br>
    <div>
        <h3>Artist</h3>
        <label class="entry_label" for="artist">Artist</label>
        <input class="text_entry" type="text" id="artist">
    </div>
    <br>
    <div>
        <h3>Genre</h3>
        <label class="entry_label" for="genre">Genre</label>
        <input class="text_entry" type="text" id="genre">
    </div>
    <br>
    <div>
        <h3>Release Date</h3>
        <label class="entry_label" for="release_date">Release Date</label>
        <input class="text_entry" type="date" id="release_date">
    </div>
    <div id="interaction">
        <div id="button_list">
            <button class="button"
                    onmouseup="addData(document.getElementById('album').value,document.getElementById('artist').value,document.getElementById('genre').value,new Date(document.getElementById('release_date').value),document.getElementById('release_date').value)">
                Add
            </button>
            <button class="button"
                    onmouseup="if (selectedRow !== -1) {data.splice(selectedRow,1); selectedRow = -1; reloadTable()}">
                Remove
            </button>
            <button class="button" onmouseup="
            if (selectedRow !== -1){
                data[selectedRow].album = document.getElementById('album').value;
                data[selectedRow].artist = document.getElementById('artist').value;
                data[selectedRow].genre = document.getElementById('genre').value;
                data[selectedRow].reld = new Date(document.getElementById('release_date').value);
                data[selectedRow].dreld = document.getElementById('release_date').value;
                reloadTable()
            }">Update
            </button>
            <button class="button" onmouseup="
            document.getElementById('album').value = null;
            document.getElementById('artist').value = null;
            document.getElementById('genre').value = null;
            document.getElementById('release_date').value = null;
            selectedRow = -1;
            reloadTable()
            ">Deselect
            </button>
            <button class="button"
                    onmouseup="document.getElementById('savemenu').style.display = 'block';document.getElementById('loadmenu').style.display= 'none';document.getElementById('saves_table').style.display= 'block'">
                Save
            </button>
            <button class="button"
                    onmouseup="document.getElementById('loadmenu').style.display = 'block';document.getElementById('savemenu').style.display= 'none';document.getElementById('saves_table').style.display= 'block'">
                Load
            </button>
        </div>
    </div>
    <div id="savemenu">
        <form id="saveinfo">
            <label for="savename" class="entry_label">Save Name</label>
            <input id="savename" class="text_entry" type="text">
            <button class="button"
                    onmouseup="save(document.getElementById('savename').value); sToCookie()">
                Submit
            </button>
            <button class="button"
                    onmouseup="document.getElementById('savemenu').style.display= 'none';document.getElementById('saves_table').style.display= 'none'">
                Cancel
            </button>
        </form>
    </div>
    <div id="loadmenu">
        <button class="button" onmouseup="document.getElementById('savemenu').style.display= 'none'; load(loadindex)">
            Load Save
        </button>
        <button class="button" onmouseup='deleteSave(loadindex); reloadSaveTable()'>
            Delete Save
        </button>
        <button class="button" onmouseup="loadindex = -1; reloadSaveTable()">
            Deselect
        </button>
        <button class="button"
                onmouseup="document.getElementById('loadmenu').style.display = 'none';document.getElementById('saves_table').style.display= 'none'">
            Cancel
        </button>
    </div>
    <div id="saves_table">
        <table id="save_list">
        </table>
    </div>
</div>
<div id="list">
    <h1>Songs</h1>
    <table id="album_list">
        <tr>
            <th>Album</th>
            <th>Artist</th>
            <th>Genre</th>
            <th>Release Date</th>
        </tr>
    </table>
</div>
</body>
</html>